<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.R ENTERPRISES | MASTER ERP</title>
    <style>
        :root { --bg: #0b1120; --card: #1e293b; --gold: #fbbf24; --green: #22c55e; --blue: #3b82f6; --red: #ef4444; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; padding: 0; }
        .section { display: none; padding: 15px; }
        .active { display: block; }
        .no-print { display: block; }

        /* üî• PRINT ENGINE FIX üî• */
        @media print {
            @page { size: A4; margin: 5mm; }
            body { background: white !important; color: black !important; }
            /* Hide EVERYTHING except the section with class "active" */
            body > *:not(.active) { display: none !important; }
            /* Inside active section, hide UI elements */
            .no-print, .float-box, .back-nav-bottom, button, .shop-header, .admin-btn, .inventory-form { display: none !important; }
            .section.active { display: block !important; width: 100% !important; padding: 0 !important; margin: 0 !important; }
            .form-box { box-shadow: none !important; border: none !important; width: 100% !important; color: black !important; }
            .excel-table { width: 100% !important; border: 2px solid #000 !important; color: black !important; }
            .excel-table th, .excel-table td { border: 1.5px solid #000 !important; padding: 10px !important; color: black !important; font-weight: bold !important; }
            #printFooter { display: flex !important; justify-content: space-between; visibility: visible !important; margin-top: 30px; border-top: 2px solid #000; padding-top: 15px; }
            input { border: none !important; background: transparent !important; color: black !important; font-weight: bold !important; font-size: 14px !important; }
        }

        /* Dashboard & UI Styling */
        .admin-btn { height: 70px; width: 100%; margin-bottom: 10px; cursor: pointer; border-radius: 8px; border: none; color: white; font-weight: bold; }
        .shop-header { background: #131921; padding: 15px; text-align: center; border-bottom: 3px solid var(--gold); }
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .p-card { background: var(--card); border-radius: 12px; padding: 10px; text-align: center; }
        .form-box { background: white; color: black; padding: 20px; border-radius: 12px; max-width: 850px; margin: auto; }
        .form-row { display: flex; align-items: center; margin-bottom: 10px; gap: 8px; }
        .calc-container { display: flex; flex-direction: column; align-items: flex-end; margin-top: 15px; gap: 5px; }
        .back-nav-bottom { position: fixed; bottom: 0; left: 0; width: 100%; background: #131921; padding: 15px; text-align: center; border-top: 2px solid var(--gold); cursor: pointer; color: var(--gold); font-weight: bold; z-index: 1000; }
        #printFooter { display: none; }
    </style>
</head>
<body>

<div id="shopPage" class="section active no-print">
    <div class="shop-header" onclick="adminLogin()"><h1 style="color:var(--gold); margin:0;">S.R ENTERPRISES</h1><p>ADMIN LOGIN</p></div>
    <div class="product-grid" id="catalog"></div>
</div>

<div id="adminPanel" class="section no-print">
    <h2 style="color:var(--gold); text-align:center;">SR ADMIN DASHBOARD</h2>
    <div style="padding: 10px;">
        <button class="admin-btn" style="background:var(--blue);" onclick="goTo('billPage')">üìù NEW BILLING</button>
        <button class="admin-btn" style="background:var(--green);" onclick="goTo('dealerPage')">ü§ù SHASHI DEALER</button>
        <button class="admin-btn" style="background:#a855f7;" onclick="goTo('crmPage')">üìä CUSTOMER RECORDS</button>
        <button class="admin-btn" style="background:#f97316;" onclick="goTo('inventoryPage')">üì¶ INVENTORY & STOCK</button>
    </div>
    <div class="back-nav-bottom" onclick="location.reload()">üîí LOGOUT / HOME</div>
</div>

<div id="billPage" class="section">
    <div class="form-box">
        <h2 style="text-align:center; color:var(--blue); margin:0;">S.R ENTERPRISES</h2>
        <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:12px; margin-bottom:10px; border-bottom: 1.5px solid #000;">
            <span>INV NO: <input type="text" id="invNo" value="SR-101"></span>
            <span>DATE: <input type="date" id="invDate"></span>
        </div>
        <div class="form-row"><label>CUSTOMER:</label><input type="text" id="bName"></div>
        <div class="form-row"><label>ADDRESS:</label><input type="text" id="bAddr"></div>
        <div class="form-row"><label>MOBILE:</label><input type="text" id="bMob"></div>
        
        <table class="excel-table" id="billTable">
            <thead><tr style="background:#eee;"><th>DESCRIPTION</th><th>RATE</th><th>QTY</th><th>TOTAL</th></tr></thead>
            <tbody id="billBody">
                <tr><td><input type="text" placeholder="Item Name"></td><td><input type="number" value="0" oninput="calcBill()"></td><td><input type="number" value="1" oninput="calcBill()"></td><td>‚Çπ 0</td></tr>
            </tbody>
        </table>
        <button class="buy-btn no-print" onclick="addRow()">+ ADD ITEM</button>

        <div class="calc-container">
            <div class="no-print"><label>GST 18%:</label><input type="checkbox" id="gstCheck" onchange="calcBill()"></div>
            <div class="no-print"><label>DISCOUNT:</label><input type="number" id="disc" value="0" oninput="calcBill()"></div>
            <h2 style="margin:5px 0;">GRAND TOTAL: ‚Çπ <span id="gTotal">0</span></h2>
            <p id="wordTotal" style="font-weight: bold; font-style: italic;"></p>
        </div>
        
        <button class="buy-btn no-print" style="background:var(--green); color:white; padding:15px;" onclick="saveSalesWithStock()">üñ®Ô∏è PRINT & SAVE BILL</button>

        <div id="printFooter">
            <div class="bank-side">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=upi://pay?pa=7021733860@sbi&pn=HariRam" style="width:110px; border:2px solid #000;">
                <p><b>SBI A/C: ....9584 | IFSC: SBIN0000000</b></p>
            </div>
            <div class="sign-side"><p style="margin-top:50px; font-weight:bold;">Authorised Signature</p></div>
        </div>
    </div>
    <div class="back-nav-bottom no-print" onclick="goTo('adminPanel')">‚¨ÖÔ∏è BACK TO ADMIN</div>
</div>

<div id="inventoryPage" class="section">
    <div class="form-box">
        <h3>üì¶ INVENTORY STOCK & ADD QTY</h3>
        <div class="inventory-form no-print" style="background:#f1f5f9; padding:15px; border-radius:8px; margin-bottom:15px;">
            <div class="form-row"><input type="text" id="partName" placeholder="Part Name"> <input type="number" id="partQty" placeholder="Add Quantity"></div>
            <button class="buy-btn" style="background:var(--green); color:white;" onclick="updateStock('add')">+ ADD STOCK</button>
        </div>
        <input type="text" placeholder="üîç Search Spare Parts..." onkeyup="searchTable('invBody', this.value)" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px;">
        <div class="table-wrap"><table class="excel-table"><thead><tr><th>PART NAME</th><th>TYPE</th><th>RATE</th><th>STOCK</th></tr></thead><tbody id="invBody"></tbody></table></div>
    </div>
    <div class="back-nav-bottom no-print" onclick="goTo('adminPanel')">‚¨ÖÔ∏è BACK TO ADMIN</div>
</div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwy11W8yIHNmRU4X1LxKR6CaSF6WCBZDxDgN6zmKhP2Cq9q4d_wiy22kxhRxs1WLCle/exec';

    function goTo(id) { 
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active')); 
        document.getElementById(id).classList.add('active'); 
        window.scrollTo(0,0); 
    }

    async function saveSalesWithStock() {
        // [Logic to send Sales and Deduct Stock in one go]
        window.print(); // Ab sirf active bill hi print hoga!
    }

    // Baki functions (calcBill, loadData, searchTable) sahi se map kiye gaye hain
</script>
</body>
        </html>
        
