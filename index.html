<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.R ENTERPRISES | MASTER ERP</title>
    <style>
        :root { --bg: #0b1120; --card: #1e293b; --gold: #fbbf24; --green: #22c55e; --blue: #3b82f6; --red: #ef4444; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; padding: 0; overflow-x: hidden; }
        .section { display: none; padding: 15px; padding-bottom: 100px; }
        .active { display: block; }
        .admin-btn { height: 75px !important; font-size: 16px !important; letter-spacing: 1px; text-transform: uppercase; font-weight: bold; width: 100%; margin-bottom: 10px; cursor: pointer; border-radius: 8px; border: none; color: white; }
        .shop-header { background: #131921; padding: 15px; text-align: center; border-bottom: 3px solid var(--gold); cursor:pointer; }
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .p-card { background: var(--card); border-radius: 12px; padding: 10px; border: 1px solid #334155; text-align: center; display: flex; flex-direction: column; justify-content: space-between; min-height: 200px; }
        .p-name { font-size: 11px; font-weight: bold; height: 35px; overflow: hidden; margin: 5px 0; }
        .buy-btn { background: var(--gold); color: black; border: none; width: 100%; padding: 10px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 11px; }
        .form-box { background: white; color: black; padding: 20px; border-radius: 12px; max-width: 850px; margin: auto; }
        .form-row { display: flex; align-items: center; margin-bottom: 10px; gap: 8px; }
        .form-row label { flex: 1; font-weight: bold; font-size: 11px; color: #333; text-transform: uppercase; }
        .form-row input, .form-row select, .form-row textarea { flex: 2; padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-weight: bold; box-sizing: border-box; font-size: 14px; }
        .excel-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 10px; background: white; color: black; border: 1px solid #ddd; table-layout: auto; }
        .excel-table th, .excel-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .excel-table th { background: #334155; color: white; }
        .wa-report-btn { background: #25d366; color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px; width: 100%; }
        .calc-container { width: 100%; display: flex; flex-direction: column; align-items: flex-end; margin-top: 15px; gap: 8px; }
        .calc-item { display: flex; align-items: center; gap: 10px; justify-content: flex-end; width: 320px; }
        .calc-item label { font-weight: bold; font-size: 13px; color: #333; flex: 1; text-align: right; }
        .calc-item input { width: 130px; padding: 10px; font-weight: bold; font-size: 16px; border: 1px solid #ccc; border-radius: 5px; }
        .float-box { position: fixed; bottom: 85px; right: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 1000; }
        .f-btn { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 25px; color: white; border:none; box-shadow: 0 4px 10px rgba(0,0,0,0.3); text-decoration: none; cursor:pointer; }
        
        @media print {
            @page { size: A4; margin: 5mm; }
            html, body { background: white !important; color: black !important; overflow: visible !important; height: auto !important; }
            body > *:not(.active) { display: none !important; }
            .no-print, .float-box, .back-nav-bottom, button, .shop-header, .admin-btn { display: none !important; }
            .section.active { display: block !important; position: static !important; width: 100% !important; padding: 0 !important; margin: 0 !important; }
            h2 { font-size: 26px !important; color: black !important; text-align: center !important; text-decoration: underline; margin-bottom: 20px !important; }
            .excel-table { width: 100% !important; border: 2px solid #000 !important; font-size: 13px !important; }
            #printFooter { display: flex !important; justify-content: space-between; align-items: flex-start; margin-top: 40px; border-top: 2px solid #000; padding-top: 20px; visibility: visible !important; }
            .bank-side { width: 65%; text-align: left !important; line-height: 1.6; }
            .sign-side { width: 30%; text-align: right !important; }
        }
        #printFooter { display: none; }
    </style>
</head>
<body>

<div id="shopPage" class="section active no-print">
    <div class="shop-header" onclick="adminLogin()"><h1 style="color:var(--gold); margin:0;">S.R ENTERPRISES</h1><p style="font-size:10px; color:#ccc;">ADMIN LOGIN</p></div>
    <div class="product-grid" id="catalog"></div>
</div>

<div id="adminPanel" class="section no-print">
    <h2 style="color:var(--gold); text-align:center;">SR ADMIN DASHBOARD</h2>
    <div style="padding: 10px;">
        <button class="buy-btn admin-btn" style="background:var(--blue);" onclick="goTo('billPage')">üìù NEW BILLING</button>
        <button class="buy-btn admin-btn" style="background:var(--green);" onclick="goTo('dealerPage')">ü§ù SHASHI DEALER</button>
        <button class="buy-btn admin-btn" style="background:#a855f7;" onclick="goTo('crmPage')">üìä CUSTOMER RECORDS</button>
        <button class="buy-btn admin-btn" style="background:#f97316;" onclick="goTo('inventoryPage')">üì¶ INVENTORY STOCK</button>
    </div>
    <div class="back-nav-bottom" onclick="location.reload()" style="position:fixed; bottom:0; width:100%; background:#131921; padding:18px; text-align:center; color:var(--gold); font-weight:bold; cursor:pointer; z-index:1000;">üîí LOGOUT / HOME</div>
</div>

<div id="billPage" class="section">
    <div class="form-box">
        <h2 style="text-align:center; color:var(--blue); margin:0;">S.R ENTERPRISES</h2>
        <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:12px; margin-bottom:15px; border-bottom: 1.5px solid #000;">
            <span>INV NO: <input type="text" id="invNo" style="width:70px;" value="SR-101"></span>
            <span>DATE: <input type="date" id="invDate"></span>
        </div>
        <div class="form-row"><label>CUSTOMER:</label><input type="text" id="bName"></div>
        <div class="form-row"><label>ADDRESS:</label><input type="text" id="bAddr"></div>
        <div class="form-row"><label>MOBILE:</label><div style="flex:2; display:flex; gap:5px;"><input type="text" id="bMob" style="flex:1;"><button onclick="pickContact()" class="no-print">üë§</button></div></div>
        
        <table class="excel-table" id="billTable" style="table-layout: fixed;">
            <thead><tr style="background:#eee;"><th style="width:45%">DESCRIPTION</th><th style="width:20%">RATE</th><th style="width:15%">QTY</th><th style="width:20%">TOTAL</th></tr></thead>
            <tbody id="billBody">
                <tr><td><input type="text" style="width:100%; border:none; background:transparent;" placeholder="Item Name"></td><td><input type="number" style="width:100%; border:none; background:transparent;" value="0" oninput="calcBill()"></td><td><input type="number" style="width:100%; border:none; background:transparent;" value="1" oninput="calcBill()"></td><td>‚Çπ 0</td></tr>
            </tbody>
        </table>
        <button class="buy-btn no-print" style="background:var(--blue); color:white; margin-top:10px;" onclick="addRow()">+ ADD ITEM</button>

        <div class="calc-container">
            <div class="calc-item"><label>GST 18%:</label><input type="checkbox" id="gstCheck" style="width:25px; height:25px;" onchange="calcBill()"></div>
            <div class="calc-item"><label>DISCOUNT (‚Çπ):</label><input type="number" id="disc" value="0" oninput="calcBill()"></div>
            <div class="calc-item"><label style="color:var(--blue); font-size: 18px;">GRAND TOTAL:</label><div style="font-size: 22px; font-weight: bold; border-bottom: 2.5px solid #000;">‚Çπ <span id="gTotal">0</span></div></div>
            <p id="wordTotal" style="font-weight: bold; font-size: 13px; color: #000; margin-top: 5px; font-style: italic;"></p>
        </div>
        
        <button class="buy-btn no-print" style="background:var(--green); color:white; padding:15px; margin-top:10px;" onclick="saveSalesWithStock()">üñ®Ô∏è PRINT & DEDUCT STOCK</button>

        <div id="printFooter">
            <div class="bank-side">
                <div style="display: flex; gap: 15px; align-items: flex-start;">
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay?pa=7021733860@sbi&pn=HariRam" style="width:115px; border:2px solid #000;">
                    <div><p style="margin:2px 0;"><b>BENEFICIARY: HARIRAM SITARAM RAJBHAR</b></p><p style="margin:2px 0;">BANK: SBI (A/C: ....9584) | IFSC: SBIN0000000</p><p style="margin:2px 0;">UPI ID: 7021733860@sbi</p></div>
                </div>
            </div>
            <div class="sign-side"><p style="margin-top:60px; font-weight:bold;">____________________<br>Authorised Signature</p></div>
        </div>
    </div>
    <div class="back-nav-bottom no-print" onclick="goTo('adminPanel')">‚¨ÖÔ∏è BACK TO ADMIN</div>
</div>

<div id="dealerPage" class="section">
    <div class="form-box">
        <h3 style="color:#f97316;">ü§ù DEALER: SHASHI JI LEDGER</h3>
        <div class="form-row"><label>DATE:</label><input type="date" id="dDate"></div>
        <div class="form-row"><label>CAT:</label>
            <select id="dCat">
                <option value="Purchase Items (+)">Purchase Items (+)</option>
                <option value="Calls Attend (-)">Calls Attend (-)</option>
                <option value="Business Payment (-)">Business Payment (-)</option>
            </select>
        </div>
        <div class="form-row"><label>ADDR:</label><input type="text" id="dAddr" placeholder="Location"></div>
        <div class="form-row"><label>DETAIL:</label><input type="text" id="dDetail" placeholder="Work Detail"></div>
        <div class="form-row"><label>AMT:</label><input type="number" id="dAmt" placeholder="‚Çπ"></div>
        <button class="buy-btn" style="background:var(--green); color:white; padding:15px;" onclick="saveToSheet('dealer')">SAVE TO GOOGLE SHEET</button>
        <button class="wa-report-btn" onclick="sendWA('dealerBody', 'SHASHI JI LEDGER REPORT')">üì§ SEND REPORT ON WHATSAPP</button>
        <div class="table-wrap"><table class="excel-table"><thead><tr><th>DATE</th><th>CAT</th><th>ADDR</th><th>DETAIL</th><th>AMT</th></tr></thead><tbody id="dealerBody"></tbody></table></div>
    </div>
    <div class="back-nav-bottom no-print" onclick="goTo('adminPanel')">‚¨ÖÔ∏è BACK TO ADMIN</div>
</div>

<div id="crmPage" class="section">
    <div class="form-box" style="max-width: 1000px;">
        <h3>üìä CUSTOMER RECORDS (CRM)</h3>
        <div style="background:#f1f5f9; padding:15px; border-radius:10px; margin-bottom:15px; border: 1px solid #ddd;" class="no-print">
            <div class="form-row"><input type="text" id="cn" placeholder="Name"> <input type="number" id="cm" placeholder="Mobile"></div>
            <div class="form-row"><input type="text" id="ca" placeholder="Address"> <input type="text" id="cw" placeholder="Work Detail"></div>
            <button class="buy-btn" style="background:var(--green); color:white;" onclick="saveToSheet('crm')">SAVE CUSTOMER</button>
        </div>
        <input type="text" placeholder="üîç Search records..." onkeyup="searchTable('crmBody', this.value)" style="width:100%; padding:10px; margin-bottom:10px; border-radius:8px;">
        <button class="wa-report-btn" onclick="sendWA('crmBody', 'CUSTOMER CRM REPORT')">üì§ SEND CRM ON WHATSAPP</button>
        <div class="table-wrap">
            <table class="excel-table">
                <thead><tr><th>NAME</th><th>MOB</th><th>ADDR</th><th>WORK</th><th>DATE</th><th>NEXT DUE</th><th>STATUS</th></tr></thead>
                <tbody id="crmBody"></tbody>
            </table>
        </div>
    </div>
    <div class="back-nav-bottom no-print" onclick="goTo('adminPanel')">‚¨ÖÔ∏è BACK TO ADMIN</div>
</div>

<div id="inventoryPage" class="section">
    <div class="form-box">
        <h3>üì¶ ADVANCED INVENTORY STOCK</h3>
        <input type="text" placeholder="üîç Search Stock (Part Name, Type)..." onkeyup="searchTable('invBody', this.value)" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px;">
        <div class="table-wrap"><table class="excel-table"><thead><tr><th>PART NAME</th><th>TYPE</th><th>RATE</th><th>STOCK</th><th>STATUS</th></tr></thead><tbody id="invBody"></tbody></table></div>
    </div>
    <div class="back-nav-bottom no-print" onclick="goTo('adminPanel')">‚¨ÖÔ∏è BACK TO ADMIN</div>
</div>

<div class="float-box no-print">
    <a href="https://wa.me/919326113988" class="f-btn" style="background:#25d366;">üí¨</a>
    <a href="tel:919326113988" class="f-btn" style="background:var(--blue);">üìû</a>
</div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwy11W8yIHNmRU4X1LxKR6CaSF6WCBZDxDgN6zmKhP2Cq9q4d_wiy22kxhRxs1WLCle/exec';

    window.onload = () => {
        loadData('Dealer_Ledger', 'dealerBody');
        loadData('Customer_CRM', 'crmBody');
        loadData('Inventory', 'invBody');
        loadCatalog();
        document.getElementById('invDate').valueAsDate = new Date();
        document.getElementById('dDate').valueAsDate = new Date();
    };

    function loadCatalog() {
        const p = [{n:"SRE-250 Mini Fusing", p:48000, i:"üè≠"}, {n:"Hashima HP-450MS", p:215000, i:"ü§ñ"}, {n:"HP-450MS Belt Set", p:14000, i:"‚û∞"}, {n:"Heating Element", p:3800, i:"üî•"}, {n:"Thermostat Omron", p:5950, i:"üå°Ô∏è"}, {n:"Linix Motor AC 220V", p:14950, i:"üîå"}, {n:"Silicon Spray", p:2250, i:"üß¥"}, {n:"Machine Service", p:1500, i:"üõ†Ô∏è"}];
        let h = ''; p.forEach(item => { h += `<div class="p-card"><div class="p-icon">${item.i}</div><div class="p-name">${item.n}</div><div style="color:var(--gold);font-weight:bold;">‚Çπ${item.p.toLocaleString()}</div><button class="buy-btn">BUY NOW</button></div>`; });
        document.getElementById('catalog').innerHTML = h;
    }

    async function saveToSheet(type) {
        const p = new URLSearchParams();
        if(type==='dealer') {
            p.append('action', 'saveDealer');
            p.append('date', document.getElementById('dDate').value);
            p.append('cat', document.getElementById('dCat').value);
            p.append('addr', document.getElementById('dAddr').value);
            p.append('detail', document.getElementById('dDetail').value);
            p.append('amt', document.getElementById('dAmt').value);
        } else {
            p.append('action', 'saveCRM');
            p.append('name', document.getElementById('cn').value);
            p.append('mob', document.getElementById('cm').value);
            p.append('addr', document.getElementById('ca').value);
            p.append('work', document.getElementById('cw').value);
        }
        await fetch(scriptURL, {method: 'POST', body: p, mode: 'no-cors'});
        alert("SYNC SUCCESSFUL!");
        location.reload();
    }

    async function saveSalesWithStock() {
        let items = [];
        document.querySelectorAll('#billBody tr').forEach(r => {
            let name = r.querySelector('td:nth-child(1) input').value;
            let qty = parseFloat(r.querySelector('td:nth-child(3) input').value) || 0;
            if(name) items.push({name: name, qty: qty});
        });
        const p = new URLSearchParams();
        p.append('action', 'saveSales');
        p.append('invNo', document.getElementById('invNo').value);
        p.append('name', document.getElementById('bName').value);
        p.append('total', document.getElementById('gTotal').innerText);
        p.append('items', JSON.stringify(items));
        await fetch(scriptURL, {method: 'POST', body: p, mode: 'no-cors'});
        alert("Stock Deducted & Sale Saved!");
        window.print();
        location.reload();
    }

    async function loadData(sheet, tableId) {
        const resp = await fetch(`${scriptURL}?sheet=${sheet}`);
        const data = await resp.json();
        let rows = "";
        data.forEach((r, i) => { if(i>0) rows += `<tr>${r.map(td => `<td>${td}</td>`).join('')}</tr>`; });
        if(document.getElementById(tableId)) document.getElementById(tableId).innerHTML = rows;
    }

    function goTo(id) { document.querySelectorAll('.section').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); window.scrollTo(0,0); }
    function searchTable(id, val) { let rows = document.querySelectorAll(`#${id} tr`); rows.forEach(r => r.style.display = r.innerText.toLowerCase().includes(val.toLowerCase()) ? '' : 'none'); }
    function adminLogin() { if(prompt("Password:") === "1234") goTo('adminPanel'); }
    function addRow() { const tr = document.createElement('tr'); tr.innerHTML = `<td><input type="text" style="width:100%; border:none;"></td><td><input type="number" style="width:100%; border:none;" value="0" oninput="calcBill()"></td><td><input type="number" style="width:100%; border:none;" value="1" oninput="calcBill()"></td><td>‚Çπ 0</td>`; document.getElementById('billBody').appendChild(tr); }
    function calcBill() { 
        let sub = 0; document.querySelectorAll('#billBody tr').forEach(r => { 
            let rt = parseFloat(r.querySelector('td:nth-child(2) input').value)||0; let qt = parseFloat(r.querySelector('td:nth-child(3) input').value)||0; 
            let rowTot = rt*qt; r.querySelector('td:last-child').innerText = "‚Çπ " + rowTot; sub += rowTot; 
        }); 
        let d = parseFloat(document.getElementById('disc').value)||0; let f = sub - d; 
        if(document.getElementById('gstCheck').checked) f *= 1.18; 
        let final = Math.round(f); document.getElementById('gTotal').innerText = final.toLocaleString(); 
        document.getElementById('wordTotal').innerText = "Amount in words: " + numberToWords(final);
    }
    function sendWA(tableId, title) { let text = `*${title}*\n\n`; document.querySelectorAll(`#${tableId} tr`).forEach(tr => { tr.querySelectorAll('td').forEach(td => { text += td.innerText + " | "; }); text += "\n"; }); window.open(`https://wa.me/919326113988?text=${encodeURIComponent(text)}`); }
    function numberToWords(num) {
        if (num === 0) return "Zero Rupees Only";
        const a = ['', 'One ', 'Two ', 'Three ', 'Four ', 'Five ', 'Six ', 'Seven ', 'Eight ', 'Nine ', 'Ten ', 'Eleven ', 'Twelve ', 'Thirteen ', 'Fourteen ', 'Fifteen ', 'Sixteen ', 'Seventeen ', 'Eighteen ', 'Nineteen '];
        const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
        let words = '';
        if (num >= 1000) { words += a[Math.floor(num / 1000)] + 'Thousand '; num %= 1000; }
        if (num >= 100) { words += a[Math.floor(num / 100)] + 'Hundred '; num %= 100; }
        if (num > 19) { words += b[Math.floor(num / 10)] + ' ' + a[num % 10]; }
        else { words += a[num]; }
        return words + "Rupees Only";
    }
    async function pickContact() { try { const c = await navigator.contacts.select(['name', 'tel'], {multiple: false}); if(c.length) { document.getElementById('bName').value = c[0].name[0]; document.getElementById('bMob').value = c[0].tel[0].replace(/\D/g,'').slice(-10); } } catch (e) { alert("Use Chrome Mobile."); } }
</script>
</body>
                                                                                                                                                                                            </html>
                                                                                                                                                        
